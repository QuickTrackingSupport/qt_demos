import*as e from"@system.app";import*as t from"@system.router";import*as n from"@system.storage";import*as i from"@system.device";import*as r from"@system.network";import*as a from"@system.fetch";var s={d:function(e,t){for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}};s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};var o={};s.d(o,{Z:function(){return pe}});var u={TRACK_DOMAIN:"trackDomain",APPKEY:"appKey",showLog:"showLog",APP_START:"$$_app_start",APP_END:"$$_app_end",PAGE_START:"$$_page_start",PAGE_END:"$$_page_end",USER_PROFILE:"$$_user_profile",EKV_SHARE:"$$_share",PAGE_TITLE:"page_title",PAGE_NAME:"page_name",EKVS:"ekvs",PAGE_CONFIG:"pageConfig",EVENT_MAX_COUNT:1e4,MEMORY_MAX_COUNT:1,CURRENT_SESSION:"current_session",SESSION_INTERVAL:3e4,MAX_QUEUE_COUNT:50,MAX_REQUEST_TIMEOUT:5e3,MAX_EVENTID_LENGTH:128,MAX_PROPERTY_KEY_LENGTH:128,MAX_PROPERTY_KEYS_COUNT:100,ID_TRACKING:"id_tracking",ID_TYPE:"id_type",APP_VERSION:"app_version",IMPRINT:"imprint",Requests:"Requests",FailedRequests:"failedRequests",QT_REMOTE_CONFIG:"QT_REMOTE_CONFIG",QT_IMPRINT_VERSION:"QT_IMPRINT_VERSION",QT_DEVICE_ENABLE:"deviceEnable",QT_EVENT_LIMITRATES:"QT_EVENT_LIMITRATES",GlobalProperty:"globalproperty",UUID_SUFFIX:"ud",DEBUGID:"debugId",DataType:{EKV:"ekv"},IDType:{uuid:"uuid",userId:"userId",openId:"openId",unionId:"unionId",androidId:"androidId",advertisingId:"advertisingId",phonenumber:"phonenumber",mac:"mac",oaid:"oaid",serial:"serial",deviceId:"deviceId"},ID_MAP:{uuid:"ud",unionid:"und",openid:"od",android_id:"android_id",advertisingId:"advertising_id",phonenumber:"phonenumber"},Header_Map_H:{sdk_type:"sdt",language:"lang",device_type:"dt",os_version:"ov",os:"os",appKey:"ak",sdk_version:"sv",resolution:"rl",pixel_ratio:"pr",id_type:"it",id_tracking:"itr",access:"ac",device_manufacturer:"dmf",device_model:"dm",device_name:"dn",platform_version:"pv",platform_sdk_version:"psv",device_brand:"db",debugId:"dk"},Header_Map_A:{ekvs:"e",active_user:"active_user"}},c=function(){var e=null,t=!1,n="";function i(){this.setDebug=function(e){t=e,n="[QT] -- "},this.i=function(){if(t)try{"string"==typeof arguments[0]&&(arguments[0]=n+arguments[0]),console.info.apply(console,arguments)}catch(e){}},this.e=function(){if(t)try{"string"==typeof arguments[0]&&(arguments[0]=n+arguments[0]),console.error.apply(console,arguments)}catch(e){}},this.w=function(){if(t)try{"string"==typeof arguments[0]&&(arguments[0]=n+arguments[0]),console.warn.apply(console,arguments)}catch(e){}},this.v=function(){try{"string"==typeof arguments[0]&&(arguments[0]=n+arguments[0]),console.warn.apply(console,arguments)}catch(e){}},this.tip_w=function(e){try{console.log("%c "+n+e,"background:red; padding: 4px; padding-right: 8px; border-radius: 4px; color: #fff;")}catch(e){}},this.repeat=function(e){for(var t=e;t.length<86;)t+=e;return t}}return function(){return null===e&&(e=new i),e}}();function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}var f=Array.prototype,d=Function.prototype,p=Object.prototype,h=f.slice,_=p.toString,y=p.hasOwnProperty,v=Array.isArray;function g(e,t){var n={};for(var i in e)t[i]?n[t[i]]=e[i]:n[i]=e[i];return n}d.bind,f.forEach,f.indexOf;var m={isFunction:function(e){try{return/^\s*\bfunction\b/.test(e)}catch(e){return!1}},isArray:v||function(e){return"[object Array]"===_.call(e)},isArguments:function(e){return!(!e||!y.call(e,"callee"))},toArray:function(e){return e&&e.toArray?e.toArray():this.isArray(e)||this.isArguments(e)?h.call(e):[]},isString:function(e){return"[object String]"===Object.prototype.toString.call(e)},isUndefined:function(e){return void 0===e},isDate:function(e){return"[object Date]"==_.call(e)},isBoolean:function(e){return"[object Boolean]"==_.call(e)},isNumber:function(e){return"[object Number]"==_.call(e)&&/[\d\.]+/.test(String(e))},isJSONString:function(e){try{JSON.parse(e)}catch(e){return!1}return!0},utf8Encode:function(e){var t,n,i,r,a="";for(t=n=0,i=(e=(e+"").replace(/\r\n/g,"\n").replace(/\r/g,"\n")).length,r=0;r<i;r++){var s=e.charCodeAt(r),o=null;s<128?n++:o=s>127&&s<2048?String.fromCharCode(s>>6|192,63&s|128):String.fromCharCode(s>>12|224,s>>6&63|128,63&s|128),null!==o&&(n>t&&(a+=e.substring(t,n)),a+=o,t=n=r+1)}return n>t&&(a+=e.substring(t,e.length)),a},base64Encode:function(e){var t,n,i,r,a,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o=0,u=0,c="",l=[];if(!e)return e;e=this.utf8Encode(e);do{t=(a=e.charCodeAt(o++)<<16|e.charCodeAt(o++)<<8|e.charCodeAt(o++))>>18&63,n=a>>12&63,i=a>>6&63,r=63&a,l[u++]=s.charAt(t)+s.charAt(n)+s.charAt(i)+s.charAt(r)}while(o<e.length);switch(c=l.join(""),e.length%3){case 1:c=c.slice(0,-2)+"==";break;case 2:c=c.slice(0,-1)+"="}return c},each:function(e,t){if(this.isObject(e)&&void 0===e.length)for(var n in e)y.call(e,n)&&t(n,e[n],e);else{var i,r=e.length;for(i=0;i<r&&"break"!==t(e[i],i);i++);}},eachMap:function(e,t){if(Object&&Object.keys)for(var n=Object.keys(e),i=n.length,r=0;r<i;r++){var a=n[r];t&&t(a,e[a])}else for(var s in e)t&&t(s,e[s])},isObject:function(e){if("object"!==l(e)||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t},isEmptyObject:function(e){try{if(!e)return!0;if("function"==typeof Object.keys&&0===Object.keys(e).length)return!0;for(var t in e)if(y.call(e,t))return!1;return!0}catch(e){return!1}},assign:function(e,t){return"function"!=typeof Object.assign?function(e){for(var t=Object(e),n=1;n<arguments.length;n++){var i=arguments[n];if(null!==i)for(var r in i)y.call(i,r)&&(t[r]=i[r])}return t}(e,t):Object.assign({},e,t)},find:function(e,t){try{return e.find(t)}catch(i){for(var n=0;n<e.length;n++)if(t(e[n]))return e[n]}},checkDomain:function(e){var t=new RegExp(/^((http|https|''):\/\/)?([a-zA-Z0-9][-a-zA-Z0-9]{0,62}(\.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+(:[0-9]{1,5})*)$/),n=((e||"").match(t)||[])[0];return!(!e||!n)||(c().tip_w(c().repeat("!")),c().tip_w("trackDomain error, please check trackDomain setting, current value is: "+e||0),c().tip_w("we accept these three patterns:"),c().tip_w("eg1: https://test-qtracking-xxx.com:port, port is optional"),c().tip_w("eg2: http://test-qtracking-xxx.com:port, port is optional"),c().tip_w("eg3: test-qtracking-xxx.com:port, port is optional"),c().tip_w(c().repeat("!")),!1)},checkEvent:function(e,t){if(!e||"string"!=typeof e)return c().w("eventcode is invalid, id =",e||"'' event properties = ",JSON.stringfy(t)),!1;var n=["id","du"],i={};if(n.forEach((function(e){i[e]=1})),i[e])return c().e("eventcode has conflict with reservewords: "+n.join(",")),!1;if(e.length>u.MAX_EVENTID_LENGTH)return c().e("The maximum length of eventcode shall not exceed "+u.MAX_EVENTID_LENGTH),!1;if(t&&("object"!==l(t)||this.isArray(t))&&"string"!=typeof t)return c().e("please check trackEvent properties. properties should be string or object(not include Array)"),!1;if(this.isArray(t)){var r=0;for(var a in t)if({}.hasOwnProperty.call(t,a)){if(a.length>u.MAX_PROPERTY_KEY_LENGTH)return c().e("The maximum length of property key shall not exceed "+u.MAX_PROPERTY_KEY_LENGTH),!1;if(r>=u.MAX_PROPERTY_KEYS_COUNT)return c().e("The maximum count of properties shall not exceed "+u.MAX_PROPERTY_KEYS_COUNT),!1;if(i[a])return c().e("property key has conflict with reserveWords: "+n.join(",")),!1;r+=1}}return!0},fixDomain:function(e){return-1!==e.indexOf("https://")||-1!==e.indexOf("http://")?e:(e=(/^\/\//.test(e)?"":"//")+e,/(\d+\.){3,}\d+/.test(e)?"http:"+e:"https:"+e)},checkAppKey:function(e){if(e&&this.isString(e))return e;c().tip_w(c().repeat("!")),c().tip_w("appKey error, please check appKey setting!"),c().tip_w(c().repeat("!"))},getRandomStr:function(e){for(var t="",n=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],i=0;i<Number(e);i++)t+=n[Math.round(Math.random()*(n.length-1))];return t},mangle:function(e){return{h:(t=e.header,n=u.Header_Map_H,i=g(t,n),t&&t.id_tracking&&(i[n.id_tracking||"id_tracking"]=g(t.id_tracking,u.ID_MAP)),i),a:function(e,t){var n={};if(e)for(var i in e)e[i]&&(n[t[i]]=e[i]);return n}(e.analytics,u.Header_Map_A)};var t,n,i},hasOwnProperty:y,hash:function(e,t){var n,i=t||1315423911;for(n=e.length-1;n>=0;n--)i^=(i<<5)+e.charCodeAt(n)+(i>>2);return(2147483647&i).toString(16)},clone:function(e){var t,n=Array.isArray(e)?[]:{};if("object"===l(e)){if(JSON&&JSON.parse)t=JSON.stringify(e),n=JSON.parse(t);else for(var i in e)n[i]="object"===l(e[i])?this.clone(e[i]):e[i];return n}}},b=m;function I(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function k(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var E,T,O=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),k(this,"_globalProperty",{}),k(this,"_appKey",""),k(this,"_puid",""),k(this,"_config",{}),k(this,"_pageConfig",{}),k(this,"_debugId",void 0)}var t,n,i;return t=e,i=[{key:"getInstance",value:function(){return this.instance||(this.instance=new e),this.instance}}],(n=[{key:"puid",get:function(){return this._puid},set:function(e){this._puid=e}},{key:"appKey",get:function(){return this._appKey},set:function(e){this._appKey=e}},{key:"globalproperty",get:function(){return this._globalProperty||{}},set:function(e){this._globalProperty=e}},{key:"debugId",get:function(){return this._debugId},set:function(e){this._debugId=e}},{key:"setItem",value:function(e,t){this._config[e]=t}},{key:"getItem",value:function(e){return this._config[e]}}])&&I(t.prototype,n),i&&I(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}().getInstance(),w=(E={default:()=>e.default},T={},s.d(T,E),T),S=(e=>{var t={};return s.d(t,e),t})({default:()=>t.default});function P(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function A(e,t,n){return t&&P(e.prototype,t),n&&P(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var N=A((function e(t,n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=t,this.ts=Date.now(),this.cusp=Object.create(null),b.isObject(n))for(var i in n)b.hasOwnProperty.call(n,i)&&(-1!=["ts",u.PAGE_NAME,u.PAGE_TITLE].indexOf(i)?this[i]=n[i]:this.cusp[i]=n[i]);var r=w.default.getInfo();r&&r.source&&r.source.extra&&r.source.extra.type&&(this.scene=r.source.extra.type);var a=S.default.getState();this.url=b.isObject(a)?a.path:"",this.page_name||(this.page_name=this.url),this.page_title||(this.page_title=b.isObject(a)?a.name:""),this.gp=O.globalproperty,this.track_type="0",c().i("before send eventcode =",this.id),b.isEmptyObject(this.cusp)||c().i("event properties = ",this)}));function R(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function D(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var j=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),D(this,"_maxCount",0),D(this,"_items",[]),this._maxCount=t||0}var t,n;return t=e,(n=[{key:"enqueue",value:function(e){"number"==typeof this._maxCount&&this.size()>=this._maxCount&&this.dequeue(),this._items.push(e)}},{key:"dequeue",value:function(){return this._items.shift()}},{key:"front",value:function(){return this._items[0]}},{key:"isEmpty",value:function(){return 0===this._items.length}},{key:"clear",value:function(){this._items.length=0}},{key:"size",value:function(){return this._items.length}},{key:"items",value:function(){return this._items}},{key:"print",value:function(){c().i(this._items.toString())}}])&&R(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function C(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var M=function(){function e(){var t,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n={deviceEnable:!0},(t="config")in this?Object.defineProperty(this,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):this[t]=n}var t,n,i;return t=e,i=[{key:"getInstance",value:function(){return this._instance||(this._instance=new e),this._instance}}],(n=[{key:"setItem",value:function(e,t){this.config[e]=t}},{key:"getItem",value:function(e){return this.config[e]}},{key:"getALL",value:function(){return this.config}},{key:"updateRemoteConfig",value:function(e){var t,n;e&&(b.hasOwnProperty.call(e,"currentDeviceEnable")&&this.setItem(u.QT_DEVICE_ENABLE,!!e.currentDeviceEnable),b.hasOwnProperty.call(e,"eventSamplingRate")&&b.isArray(e.eventSamplingRate)&&e.eventSamplingRate.length>0&&this.setItem(u.QT_EVENT_LIMITRATES,(t=e.eventSamplingRate,n=[],b.each(t,(function(e){e.eventIds&&e.eventIds.length>0&&b.each(e.eventIds,(function(t){n.push({eventId:t,samplingRate:e.samplingRate})}))})),n)))}}])&&C(t.prototype,n),i&&C(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}().getInstance(),q=(e=>{var t={};return s.d(t,e),t})({default:()=>n.default});function U(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function K(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var x=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),K(this,"_name",""),K(this,"_data",null),K(this,"_loaded",!1)}var t,n,i;return t=e,i=[{key:"getInstance",value:function(){return this.instance||(this.instance=new e),this.instance}}],(n=[{key:"load",value:function(e){if(this._data)e&&e();else{var t=this;this.getStorage({key:u.QT_REMOTE_CONFIG,success:function(n){if(n){var i=JSON.parse(n);M.updateRemoteConfig(i)}t._loaded=!0,t._data={},b.isFunction(e)&&e(t._loaded)},fail:function(n){c().w("cache loaded failed, errmsg = ",n),b.isFunction(e)&&e(t._loaded)}})}}},{key:"set",value:function(e){var t=e.key,n=e.value;this._data&&(this._data[t]=n)}},{key:"get",value:function(e){return(this._data||{})[e]}},{key:"isLoaded",value:function(){return this._loaded}},{key:"remove",value:function(e){this._data&&this._data[e]&&delete this._data[e]}},{key:"getAll",value:function(){return this._data}},{key:"clear",value:function(){this._data=null}},{key:"has",value:function(e){return!!this.get(e)}},{key:"getStorage",value:function(e){var t=e.key,n=e.success,i=e.fail;q.default.get({key:t,success:function(e){b.isFunction(n)&&n(e)},fail:function(e,t){c().w("get storage failed, errcode = ",t),b.isFunction(i)&&i(e)}})}},{key:"setStorage",value:function(e){var t=e.key,n=e.value,i=e.success,r=e.fail;q.default.set({key:t,value:b.isString(n)?n:JSON.stringify(n),success:function(e){b.isFunction(i)&&i(e)},fail:function(e,t){c().w("set storage failed, errcode = ".concat(t)),b.isFunction(r)&&r(e)}})}},{key:"deleteStorage",value:function(e){var t=e.key,n=e.success;q.default.delete({key:t,success:n})}}])&&U(t.prototype,n),i&&U(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}().getInstance();function G(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function F(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var L=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),F(this,"_memoryEvents",[]),F(this,"_noSessionEvents",[]),F(this,"_sessionId","sessionid")}var t,n,i;return t=e,i=[{key:"getInstance",value:function(){return this.instance||(this.instance=new e),this.instance}}],(n=[{key:"_getCacheEventsLength",value:function(e){var t=0;for(var n in e)b.isArray(e[n])&&(t+=e[n].length);return t}},{key:"_buildEkvs",value:function(e,t){var n=(e=e||{})[this._sessionId];return b.isArray(n)&&n.length?e[this._sessionId]=n.concat(t):e[this._sessionId]=[].concat(t),e}},{key:"_cacheEvents",value:function(){if(this._memoryEvents.length){var e=x.get(u.EKVS);this._getCacheEventsLength(e)+this._memoryEvents.length<=u.EVENT_MAX_COUNT&&(e=this._buildEkvs(e,this._memoryEvents),x.set(u.EKVS,e))}}},{key:"addEvent",value:function(e){this._sessionId?(this._memoryEvents.unshift(e),this._memoryEvents.length>u.MEMORY_MAX_COUNT&&(this._cacheEvents(this._sessionId),this._memoryEvents.length=0)):(c().w("session id is null: ",this._sessionId),this._noSessionEvents.unshift(e))}},{key:"setSessionId",value:function(e){if(this._sessionId=e||"sessionid",b.isArray(this._noSessionEvents)&&this._noSessionEvents.length){for(var t=0;t<this._noSessionEvents.length;t++)this.addEvent(this._noSessionEvents[t]);this._noSessionEvents.length=0}}},{key:"getEkvs",value:function(){var e=x.get(u.EKVS);return this._memoryEvents&&this._memoryEvents.length&&(e=this._buildEkvs(e,this._memoryEvents)),e}},{key:"clear",value:function(){x.remove(u.EKVS),this._memoryEvents=[],this._noSessionEvents=[]}},{key:"getEkvsLen",value:function(){var e=(x.get(u.EKVS)||{})[this._sessionId]||[],t=this._memoryEvents?this._memoryEvents.length:0;return e.length+t}}])&&G(t.prototype,n),i&&G(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}().getInstance(),Q=function(e){var t=null;return e===u.DataType.EKV&&(t=function(){var e=null,t=L.getEkvs();return t&&(e={analytics:{ekvs:b.clone(t)}},L.clear()),e}()),t},V=(e=>{var t={};return s.d(t,e),t})({default:()=>i.default}),H=(e=>{var t={};return s.d(t,e),t})({default:()=>r.default});function X(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function $(e,t){V.default.getInfo({success:function(n){var i=Number(n.windowWidth),r=Number(n.windowHeight),a=n.brand,s=n.model;e.device_type=n.deviceType,e.os=n.osType,e.os_version=n.osVersionName,e.pixel_ratio=n.screenDensity,e.resolution=i>r?i+"*"+r:r+"*"+i,e.language=n.language,e.platform_version=n.platformVersionName,e.platform_sdk_version=n.platformVersionCode,e.device_model=s,e.device_brand=a,e.device_name=s,e.device_manufacturer=n.manufacturer,e.product=n.product,t&&b.isFunction(t)&&t(e)},fail:function(n){c().i("quickapp get deviceInfo failed, errmsg=",n),t&&b.isFunction(t)&&t(e)}})}var J=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Y(this,"_header",{}),Y(this,"_loaded",!1),Y(this,"baseHeader",{sdk_version:"1.0.0",sdk_name:"qt_quickapp_sdk",platform:"quickapp",sdk_type:"quickappmp"})}var t,n,i;return t=e,i=[{key:"getInstance",value:function(){return this._instance||(this._instance=new e),this._instance}}],(n=[{key:"init",value:function(e){var t,n,i=this;t=this.baseHeader,n=function(t){i._header=t,i._loaded=!0,i._header.appKey=O.appKey,b.isFunction(e)&&e()},t.device_type="Phone",function(e,t){H.default.getType({success:function(t){e.access=t.type},fail:function(e){c().i("quickapp get network info failed. errmsg=",e)},complete:function(){$&&$(e,t)}})}(t,n)}},{key:"isLoaded",value:function(){return this._loaded}},{key:"get",value:function(){return this._header}},{key:"setItem",value:function(t,n){e.getInstance()._header[t]=n}},{key:"getItem",value:function(t){return e.getInstance()._header[t]}},{key:"setIdTracking",value:function(e){this.setItem(u.ID_TRACKING,e)}},{key:"setIdType",value:function(e){this.setItem(u.ID_TYPE,e)}}])&&X(t.prototype,n),i&&X(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}().getInstance(),B=(e=>{var t={};return s.d(t,e),t})({default:()=>a.default});function z(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function W(){return b.getRandomStr(10)+Date.now()+b.getRandomStr(7)+u.UUID_SUFFIX}var ee=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Z(this,"_idType",u.IDType.uuid),Z(this,"_uuid",""),Z(this,"_userId",""),Z(this,"_openId",""),Z(this,"_unionId",""),Z(this,"_advertisingId",""),Z(this,"_phoneNumber",""),Z(this,"_androidId",""),Z(this,"_deviceId",""),Z(this,"_mac",""),Z(this,"_serial",""),Z(this,"_oaid","")}var t,n,i;return t=e,i=[{key:"getInstance",value:function(){return this._instance||(this._instance=new e),this._instance}}],(n=[{key:"init",value:function(){this.initUUID(),this.initUserId()}},{key:"initUUID",value:function(){var e=this;x.getStorage({key:u.IDType.uuid,success:function(t){t?e._uuid=t:(e._uuid=W(),x.setStorage({key:u.IDType.uuid,value:e._uuid}))},fail:function(){e._uuid=W(),x.setStorage({key:u.IDType.uuid,value:e._uuid})}})}},{key:"initUserId",value:function(){var e=this;x.getStorage({key:u.IDType.userId,success:function(t){e._userId=t}})}},{key:"setUserId",value:function(t){e.getInstance()._userId=t,x.set({key:u.IDType.userId,value:t}),x.setStorage({key:u.IDType.userId,value:t,success:function(){c().i("login success, puid = ",t)},fail:function(e){c().w("login failed, err = ",e)}})}},{key:"setOpenId",value:function(e){this._openId=e}},{key:"setUnionId",value:function(e){this._unionId=e}},{key:"setAdvertisingId",value:function(e){this._advertisingId=e}},{key:"setPhonenum",value:function(e){this._phoneNumber=e}},{key:"setAndroidId",value:function(e){this._androidId=e}},{key:"setDeviceId",value:function(e){this._deviceId=e}},{key:"setMac",value:function(e){this._mac=e}},{key:"setSerial",value:function(e){this._serial=e}},{key:"setOaid",value:function(e){this._oaid=e}},{key:"removeUserId",value:function(e){this._userId="",x.deleteStorage({key:u.IDType.userId,success:function(){e&&c().i(e)}})}},{key:"setIDType",value:function(e){this._idType=e}},{key:"getIDType",value:function(){return this._idType}},{key:"getIDTracking",value:function(){var t={};return this._uuid&&(t.uuid=this._uuid),e.getInstance()._userId&&(t.userid=e.getInstance()._userid),e.getInstance()._advertisingId&&(t.advertisingid=e.getInstance()._advertisingId),e.getInstance()._openId&&(t.openId=e.getInstance()._openId),e.getInstance()._unionId&&(t.unionId=e.getInstance()._unionId),e.getInstance()._phoneNumber&&(t.phoneNumber=e.getInstance()._phoneNumber),e.getInstance()._androidId&&(t.androidid=e.getInstance()._phoneNumber),e.getInstance()._deviceId&&(t.deviceId=e.getInstance()._deviceId),e.getInstance()._mac&&(t.mac=e.getInstance()._mac),e.getInstance()._serial&&(t.serial=e.getInstance()._serial),e.getInstance()._oaid&&(t.oaid=e.getInstance()._oaid),t}}])&&z(t.prototype,n),i&&z(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}().getInstance();function te(e){var t,n,i=(t=e,n=O.getItem(u.TRACK_DOMAIN),b.fixDomain(n)+t);B.default.fetch({url:i,method:"GET",responseType:"json",success:function(e){e.data&&e.data.data&&(M.updateRemoteConfig(e.data.data),x.setStorage({key:u.QT_REMOTE_CONFIG,value:e.data.data}))},fail:function(e){c().w("remote configuration request failed, errmsg:",e)}})}function ne(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ie(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var re=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ie(this,"_instance",null),ie(this,"_running",!1),ie(this,"_currentType",""),ie(this,"_failRequests",[]),ie(this,"_failQueue",new j(u.MAX_QUEUE_COUNT)),ie(this,"_queue",new j(u.MAX_QUEUE_COUNT)),this._currentType=t}var t,n,i;return t=e,i=[{key:"getInstance",value:function(t){return this._instance||(this._instance=new e(t)),this._instance}}],(n=[{key:"_enqueueRequest",value:function(e,t,n){var i=this;if(J.isLoaded()){t=t||{};var r=Q(e);r&&(r.header=J,r.noCache=t.noCache,this._queue.enqueue(r)),b.isFunction(n)&&n()}else setTimeout((function(){i._enqueueRequest(e)}),100)}},{key:"_sendQueue",value:function(e,t){var n=(e===u.Requests?this._queue:this._failQueue).dequeue(),i=this;n?function(e,t,n,i){J.setIdType(ee.getIDType()),J.setIdTracking(ee.getIDTracking()),e.analytics&&(e.analytics.active_user={puid:ee._userId||O.puid||""}),e.header=b.assign(J.get(),{miniappDebugId:O.debugId,traceId:b.getRandomStr(10)+Date.now()+b.getRandomStr(9),app_version:w.default.getInfo().versionName,appid:w.default.getInfo().packageName,app_source_type:w.default.getInfo().source.type});var r=b.mangle(e),a=b.base64Encode(JSON.stringify(r)),s=function(){var e=O.getItem(u.TRACK_DOMAIN);if(b.checkDomain(e))return b.fixDomain(e)+"/wxm_logs"}();B.default.fetch({url:s,header:{"Content-Type":"qappmp/json","Msg-Type":"qappmp/json"},data:a,method:"POST",responseType:"json",success:function(i){200===i.code?(c().i("data send success:",JSON.stringify(e)),function(e){try{var t=e.imprintVersion;x.getStorage({key:u.QT_IMPRINT_VERSION,success:function(e){e&&b.isString(e)?t&&t!==e?(te(t),x.setStorage({key:u.QT_IMPRINT_VERSION,value:t})):x.getStorage({key:u.QT_REMOTE_CONFIG,success:function(e){if(e){var t=JSON.parse(e);M.updateRemoteConfig(t)}}}):(t&&te(t),t&&x.setStorage({key:u.QT_IMPRINT_VERSION,value:t}))},fail:function(e){c().w("save imprint failed!, errmsg = ",e)}})}catch(e){c().w("save imprint failed, errmsg = ",e)}}(i.data||{}),b.isFunction(t)&&t(i)):(c().w("data send failed:",a),b.isFunction(n)&&n())},fail:function(e){c().w("timeout: ",a),b.isFunction(n)&&n()},complete:function(){b.isFunction(i)&&i()}})}(n,(function(){i._sendQueue(e,t)}),(function(){n&&!n.noCache&&i._failRequests.push(n),i._sendQueue(e,t)})):(i._processFailRequests(),t&&t())}},{key:"_processFailRequests",value:function(){var e=this;this._failRequests.forEach((function(t){e._queue.enqueue(t)})),this._failRequests.length=0}},{key:"_startSend",value:function(e,t){this._sendQueue(e,(function(){b.isFunction(t)&&t()}))}},{key:"send",value:function(e,t,n){var i=this;e?this.add(e,t,(function(){i._startSend(i._currentType,n)})):i._startSend(i._currentType,n)}},{key:"add",value:function(e,t,n){this._enqueueRequest(e,t,n)}},{key:"load",value:function(){var e=this._currentType===u.Requests?this._queue:this._failedQueue,t=x.get(u.Requests);t&&t.length&&t.forEach((function(t){e.enqueue(t)})),x.remove(u.Requests)}},{key:"save",value:function(){var e=(x.get(u.FailedRequests)||[]).concat(this._failedQueue.items());e&&e.length&&x.set(u.FailedRequests,e),this._failedQueue.clear()}}])&&ne(t.prototype,n),i&&ne(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}().getInstance(u.Requests);function ae(){}ae.prototype={on:function(e,t,n){var i=this.e||(this.e={});return(i[e]||(i[e]=[])).push({fn:t,ctx:n}),this},once:function(e,t,n){var i=this;function r(){i.off(e,r),t.apply(n,arguments)}return r._=t,this.on(e,r,n)},emit:function(e){for(var t=[].slice.call(arguments,1),n=((this.e||(this.e={}))[e]||[]).slice(),i=0,r=n.length;i<r;i++)n[i].fn.apply(n[i].ctx,t);return this},off:function(e,t){var n=this.e||(this.e={}),i=n[e],r=[];if(i&&t)for(var a=0,s=i.length;a<s;a++)i[a].fn!==t&&i[a].fn._!==t&&r.push(i[a]);return r.length?n[e]=r:delete n[e],this}};var se=new ae;se.messageType={PARAMS_LOADED:0,SDK_INITED:1};var oe=se;function ue(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ce(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var le=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ce(this,"_inited",!1),ce(this,"_appStartTime",0)}var t,n;return t=e,(n=[{key:"ready",get:function(){return this._inited}},{key:"init",value:function(){var e=this;ee.init(),J.init((function(){x.load((function(t){e._inited=t,oe.emit(oe.messageType.SDK_INITED)}))}))}},{key:"sendEvent",value:function(e,t){if(this._inited&&(M.getItem(u.QT_DEVICE_ENABLE)||/^(\$\$_app_start|\$\$_app_end)$/.test(e))&&b.checkEvent(e,t)&&function(e){var t=M.getItem(u.QT_EVENT_LIMITRATES);if(t&&t.length>0){var n=b.find(t,(function(t){return t.eventId===e}));return!n||Math.ceil(1e3*Math.random())<1e3*n.samplingRate}return!0}(e)){var n=new N(e,t);L.addEvent(n),re.send(u.DataType.EKV,{noCache:!0},(function(){}))}}},{key:"appLaunch",value:function(){var e=this;this._appStartTime=Date.now(),oe.on(oe.messageType.SDK_INITED,(function(){e.sendEvent(u.APP_START,{ts:e._appStartTime})}))}},{key:"appHide",value:function(){var e=Date.now(),t=e-this._appStartTime;this.sendEvent(u.APP_END,{ts:e,duration:t})}},{key:"sendPageStart",value:function(e){this.sendEvent(u.PAGE_START,b.assign(e,{ts:Date.now()}))}},{key:"sendUserProfile",value:function(e){this.sendEvent(u.USER_PROFILE,e)}},{key:"getGlobalProperty",value:function(){return O.globalproperty||{}}},{key:"setGlobalProperty",value:function(e){if(b.isArray(e)||b.isObject(e)){var t=!1;b.eachMap(e,(function(n,i){if(b.isArray(i)||b.isObject(i))return t=!0,c().w("globalproperty k/v pair should not contain nested json format. current value=\n"),void c().w(JSON.stringify(e))})),t||(O.globalproperty=b.clone(e))}else c().w("setGlobalProperty can only be assigned as Object/Array format value.")}},{key:"appendGlobalProperty",value:function(e){b.isArray(e)||b.isObject(e)?O.globalProperty=b.clone(b.assign(O.globalProperty,e)):c().w("appendGlobalProperty can only be assigned as Object/Array format value.")}},{key:"login",value:function(e){e&&ee.setUserId(e)}},{key:"logoff",value:function(){ee.removeUserId("logoff success!")}},{key:"setIdTracking",value:function(e){for(var t in e)switch(t){case u.IDType.openId:ee.setOpenId(e[t]);break;case u.IDType.unionId:ee.setUnionId(e[t]);break;case u.IDType.androidId:ee.setAndroidId(e[t]);break;case u.IDType.advertisingId:ee.setAdvertisingId(e[t]);break;case u.IDType.phonenumber:ee.setPhonenum(e[t]);break;case u.IDType.deviceId:ee.setDeviceId(e[t]);break;case u.IDType.mac:ee.setMac(e[t]);break;case u.IDType.serial:ee.setSerial(e[t]);break;case u.IDType.oaid:ee.setOaid(e[t]);break;default:c().w("invalid id key = ",t)}}}])&&ue(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function fe(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function de(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var pe=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),de(this,"_params",{name:"qt"}),de(this,"_core",null),this._core=new le}var t,n,i;return t=e,i=[{key:"getInstance",value:function(){return this._instance||(this._instance=new e),this._instance}}],(n=[{key:"init",value:function(t){try{var n=t||function(){try{return s.g.__proto__||s.g||window}catch(e){c().w("get context failed",e)}}();n&&(n[this._params.name]=e.getInstance(),n.$app&&(n.$app[this._params.name]=e.getInstance())),this._core.init();var i=this;oe.on(oe.messageType.SDK_INITED,(function(){i._core.ready?c().v("QT SDK init success!!!"):(c().v("QT SDK init failed, current setting is: \n"),c().v(JSON.stringify(e.getInstance()._params)))}))}catch(e){c().w("qt quickapp init failed!")}}},{key:"setParams",value:function(t){var n=this;t&&b.isObject(t)&&(c().setDebug(!!t.showLog),b.eachMap(t,(function(t,i){switch(t){case u.TRACK_DOMAIN:b.checkDomain(i)&&(e.getInstance()._params[t]=i,O.setItem(u.TRACK_DOMAIN,i));break;case u.APPKEY:b.checkAppKey(i)&&(e.getInstance()._params[t]=i,O.appKey=i);break;case u.IDType.userId:O.puid=i;break;case u.GlobalProperty:n.setGlobalProperty(i);break;case u.DEBUGID:O.debugId=i;break;default:e.getInstance()._params[t]=i}})))}},{key:"setIds",value:function(e){this._core&&b.isObject(e)&&this._core.setIdTracking(e)}},{key:"appLaunch",value:function(e){this._core&&this._core.appLaunch(e)}},{key:"appHide",value:function(e){this._core&&this._core.appHide(e)}},{key:"sendPageStart",value:function(e){this._core&&this._core.sendPageStart(e)}},{key:"sendUserProfile",value:function(e){this._core&&this._core.sendUserProfile(e)}},{key:"sendEvent",value:function(e,t){this._core&&this._core.sendEvent(e,t)}},{key:"setGlobalProperty",value:function(e){this._core&&this._core.setGlobalProperty(e)}},{key:"appendGlobalProperty",value:function(e){this._core&&this._core.appendGlobalProperty(e)}},{key:"getGlobalProperty",value:function(){return this._core?this._core.getGlobalProperty():{}}},{key:"login",value:function(e){this._core.login(e)}},{key:"logoff",value:function(){this._core.logoff()}}])&&fe(t.prototype,n),i&&fe(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}().getInstance(),he=o.Z;export{he as default};