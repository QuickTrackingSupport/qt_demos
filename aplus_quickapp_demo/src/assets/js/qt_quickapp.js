import*as e from"@system.app";import*as t from"@system.router";import*as n from"@system.storage";import*as i from"@system.device";import*as r from"@system.network";import*as a from"@system.fetch";var s={d:function(e,t){for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}};s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};var o={};s.d(o,{Z:function(){return Ge}});var u="trackDomain",c="appKey",l="$$_app_start",f="$$_app_end",d="$$_page_start",h="$$_user_profile",p="page_title",v="page_name",y="ekvs",g=1e4,_=1,m=50,b=128,k=128,I=100,w="id_tracking",O="id_type",E="Requests",S="failedRequests",j="QT_REMOTE_CONFIG",P="QT_IMPRINT_VERSION",T="QT_DEVICE_ENALBE",A="QT_EVENT_LIMITRATES",D="globalproperty",q="ud",C={EKV:"ekv"},x={uuid:"uuid",userid:"userid",openid:"openid",unionid:"unionid",adroidid:"androidid",advertisingid:"advertisingid",phonenumber:"phonenumber",mac:"mac",oaid:"oaid",serial:"serial",deviceId:"deviceid"},N={uuid:"ud",unionid:"und",openid:"od",android_id:"android_id",advertisingId:"advertising_id",phonenumber:"phonenumber"},R={sdk_type:"sdt",language:"lang",device_type:"dt",os_version:"ov",os:"os",appKey:"ak",sdk_version:"sv",resolution:"rl",pixel_ratio:"pr",id_type:"it",id_tracking:"itr",access:"ac",device_manufacturer:"dmf",device_model:"dm",device_name:"dn",platform_version:"pv",platform_sdk_version:"psv",device_brand:"db",debugId:"dk"},K={ekvs:"e",active_user:"active_user"},F=function(){var e=null,t=!1,n="";function i(){this.setDebug=function(e){t=e,n="[QT] -- "},this.i=function(){if(t)try{"string"==typeof arguments[0]&&(arguments[0]=n+arguments[0]),console.info.apply(console,arguments)}catch(e){}},this.e=function(){if(t)try{"string"==typeof arguments[0]&&(arguments[0]=n+arguments[0]),console.error.apply(console,arguments)}catch(e){}},this.w=function(){if(t)try{"string"==typeof arguments[0]&&(arguments[0]=n+arguments[0]),console.warn.apply(console,arguments)}catch(e){}},this.v=function(){try{"string"==typeof arguments[0]&&(arguments[0]=n+arguments[0]),console.warn.apply(console,arguments)}catch(e){}},this.tip_w=function(e){try{console.log("%c "+n+e,"background:red; padding: 4px; padding-right: 8px; border-radius: 4px; color: #fff;")}catch(e){}},this.repeat=function(e){for(var t=e;t.length<86;)t+=e;return t}}return function(){return null===e&&(e=new i),e}}();function Q(e){return Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Q(e)}var U=Array.prototype,L=Function.prototype,G=Object.prototype,J=U.slice,M=G.toString,$=G.hasOwnProperty,V=Array.isArray;function z(e,t){var n={};for(var i in e)t[i]?n[t[i]]=e[i]:n[i]=e[i];return n}L.bind,U.forEach,U.indexOf;var H={isFunction:function(e){try{return/^\s*\bfunction\b/.test(e)}catch(e){return!1}},isArray:V||function(e){return"[object Array]"===M.call(e)},isArguments:function(e){return!(!e||!$.call(e,"callee"))},toArray:function(e){return e&&e.toArray?e.toArray():this.isArray(e)||this.isArguments(e)?J.call(e):[]},isString:function(e){return"[object String]"===Object.prototype.toString.call(e)},isUndefined:function(e){return void 0===e},isDate:function(e){return"[object Date]"==M.call(e)},isBoolean:function(e){return"[object Boolean]"==M.call(e)},isNumber:function(e){return"[object Number]"==M.call(e)&&/[\d\.]+/.test(String(e))},isJSONString:function(e){try{JSON.parse(e)}catch(e){return!1}return!0},utf8Encode:function(e){var t,n,i,r,a="";for(t=n=0,i=(e=(e+"").replace(/\r\n/g,"\n").replace(/\r/g,"\n")).length,r=0;r<i;r++){var s=e.charCodeAt(r),o=null;s<128?n++:o=s>127&&s<2048?String.fromCharCode(s>>6|192,63&s|128):String.fromCharCode(s>>12|224,s>>6&63|128,63&s|128),null!==o&&(n>t&&(a+=e.substring(t,n)),a+=o,t=n=r+1)}return n>t&&(a+=e.substring(t,e.length)),a},base64Encode:function(e){var t,n,i,r,a,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o=0,u=0,c="",l=[];if(!e)return e;e=this.utf8Encode(e);do{t=(a=e.charCodeAt(o++)<<16|e.charCodeAt(o++)<<8|e.charCodeAt(o++))>>18&63,n=a>>12&63,i=a>>6&63,r=63&a,l[u++]=s.charAt(t)+s.charAt(n)+s.charAt(i)+s.charAt(r)}while(o<e.length);switch(c=l.join(""),e.length%3){case 1:c=c.slice(0,-2)+"==";break;case 2:c=c.slice(0,-1)+"="}return c},each:function(e,t){if(this.isObject(e)&&void 0===e.length)for(var n in e)$.call(e,n)&&t(n,e[n],e);else{var i,r=e.length;for(i=0;i<r&&"break"!==t(e[i],i);i++);}},eachMap:function(e,t){if(Object&&Object.keys)for(var n=Object.keys(e),i=n.length,r=0;r<i;r++){var a=n[r];t&&t(a,e[a])}else for(var s in e)t&&t(s,e[s])},isObject:function(e){if("object"!==Q(e)||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t},isEmptyObject:function(e){try{if(!e)return!0;if("function"==typeof Object.keys&&0===Object.keys(e).length)return!0;for(var t in e)if($.call(e,t))return!1;return!0}catch(e){return!1}},assign:function(e,t){return"function"!=typeof Object.assign?function(e){for(var t=Object(e),n=1;n<arguments.length;n++){var i=arguments[n];if(null!==i)for(var r in i)$.call(i,r)&&(t[r]=i[r])}return t}(e,t):Object.assign({},e,t)},find:function(e,t){try{return e.find(t)}catch(i){for(var n=0;n<e.length;n++)if(t(e[n]))return e[n]}},checkDomain:function(e){var t=new RegExp(/^((http|https|''):\/\/)?([a-zA-Z0-9][-a-zA-Z0-9]{0,62}(\.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+(:[0-9]{1,5})*)$/),n=((e||"").match(t)||[])[0];return!(!e||!n)||(F().tip_w(F().repeat("!")),F().tip_w("trackDomain error, please check trackDomain setting, current value is: "+e||0),F().tip_w("we accept these three patterns:"),F().tip_w("eg1: https://test-qtracking-xxx.com:port, port is optional"),F().tip_w("eg2: http://test-qtracking-xxx.com:port, port is optional"),F().tip_w("eg3: test-qtracking-xxx.com:port, port is optional"),F().tip_w(F().repeat("!")),!1)},checkEvent:function(e,t){if(!e||"string"!=typeof e)return F().w("eventcode is invalid, id =",e||"'' event properties = ",JSON.stringfy(t)),!1;var n=["id","du"],i={};if(n.forEach((function(e){i[e]=1})),i[e])return F().e("eventcode has conflict with reservewords: "+n.join(",")),!1;if(e.length>b)return F().e("The maximum length of eventcode shall not exceed "+b),!1;if(t&&("object"!==Q(t)||this.isArray(t))&&"string"!=typeof t)return F().e("please check trackEvent properties. properties should be string or object(not include Array)"),!1;if(this.isArray(t)){var r=0;for(var a in t)if({}.hasOwnProperty.call(t,a)){if(a.length>k)return F().e("The maximum length of property key shall not exceed "+k),!1;if(r>=I)return F().e("The maximum count of properties shall not exceed "+I),!1;if(i[a])return F().e("property key has conflict with reserveWords: "+n.join(",")),!1;r+=1}}return!0},fixDomain:function(e){return-1!==e.indexOf("https://")||-1!==e.indexOf("http://")?e:(e=(/^\/\//.test(e)?"":"//")+e,/(\d+\.){3,}\d+/.test(e)?"http:"+e:"https:"+e)},checkAppKey:function(e){if(e&&this.isString(e))return e;F().tip_w(F().repeat("!")),F().tip_w("appKey error, please check appKey setting!"),F().tip_w(F().repeat("!"))},getRandomStr:function(e){for(var t="",n=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],i=0;i<Number(e);i++)t+=n[Math.round(Math.random()*(n.length-1))];return t},mangle:function(e){return{h:(t=e.header,n=R,i=z(t,n),t&&t.id_tracking&&(i[n.id_tracking||"id_tracking"]=z(t.id_tracking,N)),i),a:function(e,t){var n={};if(e)for(var i in e)e[i]&&(n[t[i]]=e[i]);return n}(e.analytics,K)};var t,n,i},hasOwnProperty:$,hash:function(e,t){var n,i=t||1315423911;for(n=e.length-1;n>=0;n--)i^=(i<<5)+e.charCodeAt(n)+(i>>2);return(2147483647&i).toString(16)},clone:function(e){var t,n=Array.isArray(e)?[]:{};if("object"===Q(e)){if(JSON&&JSON.parse)t=JSON.stringify(e),n=JSON.parse(t);else for(var i in e)n[i]="object"===Q(e[i])?this.clone(e[i]):e[i];return n}}},Z=H;function B(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function W(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var X,Y,ee=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),W(this,"_globalProperty",{}),W(this,"_appKey",""),W(this,"_puid",""),W(this,"_config",{}),W(this,"_pageConfig",{})}var t,n,i;return t=e,i=[{key:"getInstance",value:function(){return this.instance||(this.instance=new e),this.instance}}],(n=[{key:"puid",get:function(){return this._puid},set:function(e){this._puid=e}},{key:"appKey",get:function(){return this._appKey},set:function(e){this._appKey=e}},{key:"globalproperty",get:function(){return this._globalProperty||{}},set:function(e){this._globalProperty=e}},{key:"setItem",value:function(e,t){this._config[e]=t}},{key:"getItem",value:function(e){return this._config[e]}}])&&B(t.prototype,n),i&&B(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}().getInstance(),te=(X={default:()=>e.default},Y={},s.d(Y,X),Y),ne=(e=>{var t={};return s.d(t,e),t})({default:()=>t.default});function ie(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function re(e,t,n){return t&&ie(e.prototype,t),n&&ie(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var ae=re((function e(t,n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=t,this.ts=Date.now(),this.cusp=Object.create(null),Z.isObject(n))for(var i in n)Z.hasOwnProperty.call(n,i)&&("ts"===i?this[i]=n[i]:this.cusp[i]=n[i]);var r=te.default.getInfo();r&&r.source&&r.source.extra&&r.source.extra.scene&&(this.scene=r.source.extra.scene);var a=ne.default.getState();this.url=Z.isObject(a)?a.path:"",this.page_name=n[v]||this.url,this.page_title=n[p]||(Z.isObject(a)?a.name:""),this.gp=ee.globalproperty,this.track_type="0",F().i("before send eventcode =",this.id),Z.isEmptyObject(this.cusp)||F().i("event properties = ",this.cusp)}));function se(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function oe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ue=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),oe(this,"_maxCount",0),oe(this,"_items",[]),this._maxCount=t||0}var t,n;return t=e,(n=[{key:"enqueue",value:function(e){"number"==typeof this._maxCount&&this.size()>=this._maxCount&&this.dequeue(),this._items.push(e)}},{key:"dequeue",value:function(){return this._items.shift()}},{key:"front",value:function(){return this._items[0]}},{key:"isEmpty",value:function(){return 0===this._items.length}},{key:"clear",value:function(){this._items.length=0}},{key:"size",value:function(){return this._items.length}},{key:"items",value:function(){return this._items}},{key:"print",value:function(){F().i(this._items.toString())}}])&&se(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function ce(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var le=function(){function e(){var t,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n={},(t="config")in this?Object.defineProperty(this,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):this[t]=n}var t,n,i;return t=e,i=[{key:"getInstance",value:function(){return this._instance||(this._instance=new e),this._instance}}],(n=[{key:"setItem",value:function(e,t){this.config[e]=t}},{key:"getItem",value:function(e){return this.config[e]}},{key:"getALL",value:function(){return this.config}},{key:"updateRemoteConfig",value:function(e){var t,n;e&&(Z.hasOwnProperty.call(e,"currentDeviceEnable")&&this.setItem(T,e.currentDeviceEnable),Z.hasOwnProperty.call(e,"eventSamplingRate")&&Z.isArray(e.eventSamplingRate)&&e.eventSamplingRate.length>0&&this.setItem(A,(t=e.eventSamplingRate,n=[],Z.each(t,(function(e){e.eventIds&&e.eventIds.length>0&&Z.each(e.eventIds,(function(t){n.push({eventId:t,samplingRate:e.samplingRate})}))})),n)))}}])&&ce(t.prototype,n),i&&ce(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}().getInstance(),fe=(e=>{var t={};return s.d(t,e),t})({default:()=>n.default});function de(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function he(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var pe=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),he(this,"_name",""),he(this,"_data",null),he(this,"_loaded",!1)}var t,n,i;return t=e,i=[{key:"getInstance",value:function(){return this.instance||(this.instance=new e),this.instance}}],(n=[{key:"load",value:function(e){if(this._data)e&&e();else{var t=this;this.getStorage({key:j,success:function(n){var i=JSON.parse(n);le.updateRemoteConfig(i),t._loaded=!0,t._data={},Z.isFunction(e)&&e(t._loaded)},fail:function(n){F().w("cache loaded failed, errmsg = ",n),Z.isFunction(e)&&e(t._loaded)}})}}},{key:"set",value:function(e){var t=e.key,n=e.value;this._data&&(this._data[t]=n)}},{key:"get",value:function(e){return(this._data||{})[e]}},{key:"isLoaded",value:function(){return this._loaded}},{key:"remove",value:function(e){this._data&&this._data[e]&&delete this._data[e]}},{key:"getAll",value:function(){return this._data}},{key:"clear",value:function(){this._data=null}},{key:"has",value:function(e){return!!this.get(e)}},{key:"getStorage",value:function(e){var t=e.key,n=e.success,i=e.fail;fe.default.get({key:t,success:function(e){Z.isFunction(n)&&n(e)},fail:function(e,t){F().w("get storage failed, errcode = ",t),Z.isFunction(i)&&i(e)}})}},{key:"setStorage",value:function(e){var t=e.key,n=e.value,i=e.success,r=e.fail;fe.default.set({key:t,value:Z.isString(n)?n:JSON.stringify(n),success:function(e){Z.isFunction(i)&&i(e)},fail:function(e,t){F().w("set storage failed, errcode = ".concat(t)),Z.isFunction(r)&&r(e)}})}},{key:"deleteStorage",value:function(e){var t=e.key,n=e.success;fe.default.delete({key:t,success:n})}}])&&de(t.prototype,n),i&&de(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}().getInstance();function ve(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ye(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ge=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ye(this,"_memoryEvents",[]),ye(this,"_noSessionEvents",[]),ye(this,"_sessionId","sessionid")}var t,n,i;return t=e,i=[{key:"getInstance",value:function(){return this.instance||(this.instance=new e),this.instance}}],(n=[{key:"_getCacheEventsLength",value:function(e){var t=0;for(var n in e)Z.isArray(e[n])&&(t+=e[n].length);return t}},{key:"_buildEkvs",value:function(e,t){var n=(e=e||{})[this._sessionId];return Z.isArray(n)&&n.length?e[this._sessionId]=n.concat(t):e[this._sessionId]=[].concat(t),e}},{key:"_cacheEvents",value:function(){if(this._memoryEvents.length){var e=pe.get(y);this._getCacheEventsLength(e)+this._memoryEvents.length<=g&&(e=this._buildEkvs(e,this._memoryEvents),pe.set(y,e))}}},{key:"addEvent",value:function(e){this._sessionId?(this._memoryEvents.unshift(e),this._memoryEvents.length>_&&(this._cacheEvents(this._sessionId),this._memoryEvents.length=0)):(F().w("session id is null: ",this._sessionId),this._noSessionEvents.unshift(e))}},{key:"setSessionId",value:function(e){if(this._sessionId=e||"sessionid",Z.isArray(this._noSessionEvents)&&this._noSessionEvents.length){for(var t=0;t<this._noSessionEvents.length;t++)this.addEvent(this._noSessionEvents[t]);this._noSessionEvents.length=0}}},{key:"getEkvs",value:function(){var e=pe.get(y);return this._memoryEvents&&this._memoryEvents.length&&(e=this._buildEkvs(e,this._memoryEvents)),e}},{key:"clear",value:function(){pe.remove(y),this._memoryEvents=[],this._noSessionEvents=[]}},{key:"getEkvsLen",value:function(){var e=(pe.get(y)||{})[this._sessionId]||[],t=this._memoryEvents?this._memoryEvents.length:0;return e.length+t}}])&&ve(t.prototype,n),i&&ve(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}().getInstance(),_e=function(e){var t=null;return e===C.EKV&&(t=function(){var e=null,t=ge.getEkvs();return t&&(e={analytics:{ekvs:Z.clone(t)}},ge.clear()),e}()),t},me=(e=>{var t={};return s.d(t,e),t})({default:()=>i.default}),be=(e=>{var t={};return s.d(t,e),t})({default:()=>r.default});function ke(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Ie(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function we(e,t){me.default.getInfo({success:function(n){var i=Number(n.windowWidth),r=Number(n.windowHeight),a=n.brand,s=n.model;e.device_type=n.deviceType,e.os=n.osType,e.os_version=n.osVersionName,e.pixel_ratio=n.screenDensity,e.resolution=i>r?i+"*"+r:r+"*"+i,e.language=n.language,e.platform_version=n.platformVersionName,e.platform_sdk_version=n.platformVersionCode,e.device_model=s,e.device_brand=a,e.device_name=s,e.device_manufacturer=n.manufacturer,e.product=n.product,t&&Z.isFunction(t)&&t(e)},fail:function(n){F().i("quickapp get deviceInfo failed, errmsg=",n),t&&Z.isFunction(t)&&t(e)}})}var Oe=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Ie(this,"_header",{}),Ie(this,"_loaded",!1),Ie(this,"baseHeader",{sdk_version:"1.0.0",sdk_name:"qt_quickapp_sdk",platform:"quickapp",sdk_type:"quickappmp"})}var t,n,i;return t=e,i=[{key:"getInstance",value:function(){return this._instance||(this._instance=new e),this._instance}}],(n=[{key:"init",value:function(e){var t,n,i=this;t=this.baseHeader,n=function(t){i._header=t,i._loaded=!0,i._header.appKey=ee.appKey,Z.isFunction(e)&&e()},t.device_type="Phone",function(e,t){be.default.getType({success:function(t){e.access=t.type},fail:function(e){F().i("quickapp get network info failed. errmsg=",e)},complete:function(){we&&we(e,t)}})}(t,n)}},{key:"isLoaded",value:function(){return this._loaded}},{key:"get",value:function(){return this._header}},{key:"setItem",value:function(t,n){e.getInstance()._header[t]=n}},{key:"getItem",value:function(t){return e.getInstance()._header[t]}},{key:"setIdTracking",value:function(e){this.setItem(w,e)}},{key:"setIdType",value:function(e){this.setItem(O,e)}}])&&ke(t.prototype,n),i&&ke(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}().getInstance(),Ee=(e=>{var t={};return s.d(t,e),t})({default:()=>a.default});function Se(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function je(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Pe(){return Z.getRandomStr(10)+Date.now()+Z.getRandomStr(7)+q}var Te=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),je(this,"_idType",x.uuid),je(this,"_uuid",""),je(this,"_userId",""),je(this,"_openId",""),je(this,"_unionId",""),je(this,"_advertisingId",""),je(this,"_phoneNumber",""),je(this,"_androidId",""),je(this,"_deviceId",""),je(this,"_mac",""),je(this,"_serial",""),je(this,"_oaid","")}var t,n,i;return t=e,i=[{key:"getInstance",value:function(){return this._instance||(this._instance=new e),this._instance}}],(n=[{key:"init",value:function(){this.initUUID(),this.initUserId()}},{key:"initUUID",value:function(){var e=this;pe.getStorage({key:x.uuid,success:function(t){t?e._uuid=t:(e._uuid=Pe(),pe.setStorage({key:x.uuid,value:e._uuid}))},fail:function(){e._uuid=Pe(),pe.setStorage({key:x.uuid,value:e._uuid})}})}},{key:"initUserId",value:function(){var e=this;pe.getStorage({key:x.userid,success:function(t){e._userId=t}})}},{key:"setUserId",value:function(t){e.getInstance()._userId=t,pe.set({key:x.userid,value:t}),pe.setStorage({key:x.userid,value:t,success:function(e){F().i("login success, puid = ",e)},fail:function(e){F().w("login failed, err = ",e)}})}},{key:"setOpenId",value:function(e){this._openId=e}},{key:"setUnionId",value:function(e){this._unionId=e}},{key:"setAdvertisingId",value:function(e){this._advertisingId=e}},{key:"setPhonenum",value:function(e){this._phoneNumber=e}},{key:"setAndroidId",value:function(e){this._androidId=e}},{key:"setDeviceId",value:function(e){this._deviceId=e}},{key:"setMac",value:function(e){this._mac=e}},{key:"setSerial",value:function(e){this._serial=e}},{key:"setOaid",value:function(e){this._oaid=e}},{key:"removeUserId",value:function(e){this._userId="",pe.deleteStorage({key:x.userid,success:function(){e&&F().i(e)}})}},{key:"setIDType",value:function(e){this._idType=e}},{key:"getIDType",value:function(){return this._idType}},{key:"getIDTracking",value:function(){var t={};return this._uuid&&(t.uuid=this._uuid),e.getInstance()._userId&&(t.userid=e.getInstance()._userid),e.getInstance()._advertisingId&&(t.advertisingid=e.getInstance()._advertisingId),e.getInstance()._openId&&(t.openId=e.getInstance()._openId),e.getInstance()._unionId&&(t.unionId=e.getInstance()._unionId),e.getInstance()._phoneNumber&&(t.phoneNumber=e.getInstance()._phoneNumber),e.getInstance()._androidId&&(t.androidid=e.getInstance()._phoneNumber),e.getInstance()._deviceId&&(t.deviceId=e.getInstance()._deviceId),e.getInstance()._mac&&(t.mac=e.getInstance()._mac),e.getInstance()._serial&&(t.serial=e.getInstance()._serial),e.getInstance()._oaid&&(t.oaid=e.getInstance()._oaid),t}}])&&Se(t.prototype,n),i&&Se(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}().getInstance();function Ae(e){var t,n,i=(t=e,n=ee.getItem(u),Z.fixDomain(n)+t);Ee.default.fetch({url:i,method:"GET",responseType:"json",success:function(e){e.data&&e.data.data&&(le.updateRemoteConfig(e.data.data),pe.setStorage({key:j,value:e.data.data}))},fail:function(e){F().w("remote configuration request failed, errmsg:",e)}})}function De(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function qe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ce=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),qe(this,"_instance",null),qe(this,"_running",!1),qe(this,"_currentType",""),qe(this,"_failRequests",[]),qe(this,"_failQueue",new ue(m)),qe(this,"_queue",new ue(m)),this._currentType=t}var t,n,i;return t=e,i=[{key:"getInstance",value:function(t){return this._instance||(this._instance=new e(t)),this._instance}}],(n=[{key:"_enqueueRequest",value:function(e,t,n){var i=this;if(Oe.isLoaded()){t=t||{};var r=_e(e);r&&(r.header=Oe,r.noCache=t.noCache,this._queue.enqueue(r)),Z.isFunction(n)&&n()}else setTimeout((function(){i._enqueueRequest(e)}),100)}},{key:"_sendQueue",value:function(e,t){var n=(e===E?this._queue:this._failQueue).dequeue(),i=this;n?function(e,t,n,i){Oe.setIdType(Te.getIDType()),Oe.setIdTracking(Te.getIDTracking()),e.analytics&&(e.analytics.active_user={puid:ee.puid||""}),e.header=Z.assign(Oe.get(),{traceId:Z.getRandomStr(10)+Date.now()+Z.getRandomStr(9),app_version:te.default.getInfo().versionName,appid:te.default.getInfo().packageName,app_source_type:te.default.getInfo().source.type});var r=Z.mangle(e),a=Z.base64Encode(JSON.stringify(r)),s=function(){var e=ee.getItem(u);if(Z.checkDomain(e))return Z.fixDomain(e)+"/qappm_logs"}();Ee.default.fetch({url:s,header:{"Content-Type":"qappmp/json","Msg-Type":"qappmp/json"},data:a,method:"POST",responseType:"json",success:function(i){200===i.code?(F().i("data send success:",JSON.stringify(e)),function(e){try{var t=e.imprintVersion;pe.getStorage({key:P,success:function(e){e&&Z.isString(e)?t&&t!==e?(Ae(t),pe.setStorage({key:P,value:t})):pe.getStorage({key:j,success:function(e){var t=JSON.parse(e);le.updateRemoteConfig(t)}}):(t&&Ae(t),t&&pe.setStorage({key:P,value:t}))},fail:function(e){F().w("save imprint failed!, errmsg = ",e)}})}catch(e){F().w("save imprint failed, errmsg = ",e)}}(i.data||{}),Z.isFunction(t)&&t(i)):(F().w("data send failed:",a),Z.isFunction(n)&&n())},fail:function(e){F().w("timeout: ",a),Z.isFunction(n)&&n()},complete:function(){Z.isFunction(i)&&i()}})}(n,(function(){i._sendQueue(e,t)}),(function(){n&&!n.noCache&&i._failRequests.push(n),i._sendQueue(e,t)})):(i._processFailRequests(),t&&t())}},{key:"_processFailRequests",value:function(){var e=this;this._failRequests.forEach((function(t){e._queue.enqueue(t)})),this._failRequests.length=0}},{key:"_startSend",value:function(e,t){this._sendQueue(e,(function(){Z.isFunction(t)&&t()}))}},{key:"send",value:function(e,t,n){var i=this;e?this.add(e,t,(function(){i._startSend(i._currentType,n)})):i._startSend(i._currentType,n)}},{key:"add",value:function(e,t,n){this._enqueueRequest(e,t,n)}},{key:"load",value:function(){var e=this._currentType===E?this._queue:this._failedQueue,t=pe.get(E);t&&t.length&&t.forEach((function(t){e.enqueue(t)})),pe.remove(E)}},{key:"save",value:function(){var e=(pe.get(S)||[]).concat(this._failedQueue.items());e&&e.length&&pe.set(S,e),this._failedQueue.clear()}}])&&De(t.prototype,n),i&&De(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}().getInstance(E);function xe(){}xe.prototype={on:function(e,t,n){var i=this.e||(this.e={});return(i[e]||(i[e]=[])).push({fn:t,ctx:n}),this},once:function(e,t,n){var i=this;function r(){i.off(e,r),t.apply(n,arguments)}return r._=t,this.on(e,r,n)},emit:function(e){for(var t=[].slice.call(arguments,1),n=((this.e||(this.e={}))[e]||[]).slice(),i=0,r=n.length;i<r;i++)n[i].fn.apply(n[i].ctx,t);return this},off:function(e,t){var n=this.e||(this.e={}),i=n[e],r=[];if(i&&t)for(var a=0,s=i.length;a<s;a++)i[a].fn!==t&&i[a].fn._!==t&&r.push(i[a]);return r.length?n[e]=r:delete n[e],this}};var Ne=new xe;Ne.messageType={PARAMS_LOADED:0,SDK_INITED:1};var Re=Ne;function Ke(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Fe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Qe=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Fe(this,"_inited",!1),Fe(this,"_appStartTime",0)}var t,n;return t=e,(n=[{key:"ready",get:function(){return this._inited}},{key:"init",value:function(){var e=this;Te.init(),Oe.init((function(){pe.load((function(t){e._inited=t,Re.emit(Re.messageType.SDK_INITED)}))}))}},{key:"sendEvent",value:function(e,t){if(this._inited&&(le.getItem(T)||/^(\$\$_app_start|\$\$_app_end)$/.test(e))&&Z.checkEvent(e,t)&&function(e){var t=le.getItem(A);if(t&&t.length>0){var n=Z.find(t,(function(t){return t.eventId===e}));return!n||Math.ceil(1e3*Math.random())<1e3*n.samplingRate}return!0}(e)){var n=new ae(e,t);ge.addEvent(n),Ce.send(C.EKV,{noCache:!0},(function(){}))}}},{key:"appLaunch",value:function(){var e=this;this._appStartTime=Date.now(),Re.on(Re.messageType.SDK_INITED,(function(){e.sendEvent(l,{ts:e._appStartTime})}))}},{key:"appHide",value:function(){var e=Date.now(),t=e-this._appStartTime;this.sendEvent(f,{ts:e,duration:t})}},{key:"sendPageStart",value:function(e){this.sendEvent(d,Z.assign(e,{ts:Date.now()}))}},{key:"sendUserProfile",value:function(e){this.sendEvent(h,e)}},{key:"getGlobalProperty",value:function(){return ee.globalproperty||{}}},{key:"setGlobalProperty",value:function(e){if(Z.isArray(e)||Z.isObject(e)){var t=!1;Z.eachMap(e,(function(n,i){if(Z.isArray(i)||Z.isObject(i))return t=!0,F().w("globalproperty k/v pair should not contain nested json format. current value=\n"),void F().w(JSON.stringify(e))})),t||(ee.globalproperty=Z.clone(e))}else F().w("setGlobalProperty can only be assigned as Object/Array format value.")}},{key:"appendGlobalProperty",value:function(e){Z.isArray(e)||Z.isObject(e)?ee.globalProperty=Z.clone(Z.assign(ee.globalProperty,e)):F().w("appendGlobalProperty can only be assigned as Object/Array format value.")}},{key:"login",value:function(e){e&&Te.setUserId(e)}},{key:"logoff",value:function(){Te.removeUserId("logoff success!")}},{key:"setIdTracking",value:function(e){for(var t in e)switch(t){case x.openid:Te.setOpenId(e[t]);break;case x.unionid:Te.setUnionId(e[t]);break;case x.adroidid:Te.setAndroidId(e[t]);break;case x.advertisingid:Te.setAdvertisingId(e[t]);break;case x.phonenumber:Te.setPhonenum(e[t]);break;case x.deviceId:Te.setDeviceId(e[t]);break;case x.mac:Te.setMac(e[t]);break;case x.serial:Te.setSerial(e[t]);break;case x.oaid:Te.setOaid(e[t]);break;default:F().w("invalid id key = ",t)}}}])&&Ke(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Ue(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Le(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ge=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Le(this,"_params",{name:"qt"}),Le(this,"_core",null),this._core=new Qe}var t,n,i;return t=e,i=[{key:"getInstance",value:function(){return this._instance||(this._instance=new e),this._instance}}],(n=[{key:"init",value:function(t){try{var n=t||function(){try{return s.g.__proto__||s.g||window}catch(e){F().w("get context failed",e)}}();n&&(n[this._params.name]=e.getInstance(),n.$app&&(n.$app[this._params.name]=e.getInstance())),this._core.init();var i=this;Re.on(Re.messageType.SDK_INITED,(function(){i._core.ready?F().v("QT SDK init success!!!"):(F().v("QT SDK init failed, current setting is: \n"),F().v(JSON.stringify(e.getInstance()._params)))}))}catch(e){F().w("qt quickapp init failed!")}}},{key:"setParams",value:function(t){var n=this;t&&Z.isObject(t)&&(F().setDebug(!!t.showLog),Z.eachMap(t,(function(t,i){switch(t){case u:Z.checkDomain(i)&&(e.getInstance()._params[t]=i,ee.setItem(u,i));break;case c:Z.checkAppKey(i)&&(e.getInstance()._params[t]=i,ee.appKey=i);break;case x.userid:ee.puid=i;break;case D:n.setGlobalProperty(i);break;default:e.getInstance()._params[t]=i}})))}},{key:"setIds",value:function(e){this._core&&Z.isObject(e)&&this._core.setIdTracking(e)}},{key:"appLaunch",value:function(e){this._core&&this._core.appLaunch(e)}},{key:"appHide",value:function(e){this._core&&this._core.appHide(e)}},{key:"sendPageStart",value:function(e){this._core&&this._core.sendPageStart(e)}},{key:"sendUserProfile",value:function(e){this._core&&this._core.sendUserProfile(e)}},{key:"sendEvent",value:function(e,t){this._core&&this._core.sendEvent(e,t)}},{key:"setGlobalProperty",value:function(e){this._core&&this._core.setGlobalProperty(e)}},{key:"appendGlobalProperty",value:function(e){this._core&&this._core.appendGlobalProperty(e)}},{key:"getGlobalProperty",value:function(){return this._core?this._core.getGlobalProperty():{}}},{key:"login",value:function(e){this._core.login(e)}},{key:"logoff",value:function(){this._core.logoff()}}])&&Ue(t.prototype,n),i&&Ue(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}().getInstance(),Je=o.Z;export{Je as default};