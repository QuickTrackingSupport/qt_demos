import*as e from"@system.app";import*as t from"@system.router";import*as n from"@system.storage";import*as i from"@system.device";import*as r from"@system.network";import*as a from"@system.fetch";var s={d:function(e,t){for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}};s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};var o={};s.d(o,{Z:function(){return Je}});var u="trackDomain",c="appKey",l="$$_app_start",f="$$_app_end",d="$$_page_start",h="$$_user_profile",p="page_title",v="page_name",y="ekvs",g=1e4,_=1,m=50,b=128,k=128,I=100,w="id_tracking",O="id_type",E="Requests",S="failedRequests",j="QT_REMOTE_CONFIG",P="QT_IMPRINT_VERSION",T="QT_DEVICE_ENALBE",A="QT_EVENT_LIMITRATES",D="globalproperty",q="ud",x="debugId",C={EKV:"ekv"},N={uuid:"uuid",userid:"userid",openid:"openid",unionid:"unionid",adroidid:"androidid",advertisingid:"advertisingid",phonenumber:"phonenumber",mac:"mac",oaid:"oaid",serial:"serial",deviceId:"deviceid"},R={uuid:"ud",unionid:"und",openid:"od",android_id:"android_id",advertisingId:"advertising_id",phonenumber:"phonenumber"},K={sdk_type:"sdt",language:"lang",device_type:"dt",os_version:"ov",os:"os",appKey:"ak",sdk_version:"sv",resolution:"rl",pixel_ratio:"pr",id_type:"it",id_tracking:"itr",access:"ac",device_manufacturer:"dmf",device_model:"dm",device_name:"dn",platform_version:"pv",platform_sdk_version:"psv",device_brand:"db",debugId:"dk"},F={ekvs:"e",active_user:"active_user"},Q=function(){var e=null,t=!1,n="";function i(){this.setDebug=function(e){t=e,n="[QT] -- "},this.i=function(){if(t)try{"string"==typeof arguments[0]&&(arguments[0]=n+arguments[0]),console.info.apply(console,arguments)}catch(e){}},this.e=function(){if(t)try{"string"==typeof arguments[0]&&(arguments[0]=n+arguments[0]),console.error.apply(console,arguments)}catch(e){}},this.w=function(){if(t)try{"string"==typeof arguments[0]&&(arguments[0]=n+arguments[0]),console.warn.apply(console,arguments)}catch(e){}},this.v=function(){try{"string"==typeof arguments[0]&&(arguments[0]=n+arguments[0]),console.warn.apply(console,arguments)}catch(e){}},this.tip_w=function(e){try{console.log("%c "+n+e,"background:red; padding: 4px; padding-right: 8px; border-radius: 4px; color: #fff;")}catch(e){}},this.repeat=function(e){for(var t=e;t.length<86;)t+=e;return t}}return function(){return null===e&&(e=new i),e}}();function U(e){return U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},U(e)}var L=Array.prototype,G=Function.prototype,J=Object.prototype,M=L.slice,$=J.toString,V=J.hasOwnProperty,z=Array.isArray;function H(e,t){var n={};for(var i in e)t[i]?n[t[i]]=e[i]:n[i]=e[i];return n}G.bind,L.forEach,L.indexOf;var Z={isFunction:function(e){try{return/^\s*\bfunction\b/.test(e)}catch(e){return!1}},isArray:z||function(e){return"[object Array]"===$.call(e)},isArguments:function(e){return!(!e||!V.call(e,"callee"))},toArray:function(e){return e&&e.toArray?e.toArray():this.isArray(e)||this.isArguments(e)?M.call(e):[]},isString:function(e){return"[object String]"===Object.prototype.toString.call(e)},isUndefined:function(e){return void 0===e},isDate:function(e){return"[object Date]"==$.call(e)},isBoolean:function(e){return"[object Boolean]"==$.call(e)},isNumber:function(e){return"[object Number]"==$.call(e)&&/[\d\.]+/.test(String(e))},isJSONString:function(e){try{JSON.parse(e)}catch(e){return!1}return!0},utf8Encode:function(e){var t,n,i,r,a="";for(t=n=0,i=(e=(e+"").replace(/\r\n/g,"\n").replace(/\r/g,"\n")).length,r=0;r<i;r++){var s=e.charCodeAt(r),o=null;s<128?n++:o=s>127&&s<2048?String.fromCharCode(s>>6|192,63&s|128):String.fromCharCode(s>>12|224,s>>6&63|128,63&s|128),null!==o&&(n>t&&(a+=e.substring(t,n)),a+=o,t=n=r+1)}return n>t&&(a+=e.substring(t,e.length)),a},base64Encode:function(e){var t,n,i,r,a,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o=0,u=0,c="",l=[];if(!e)return e;e=this.utf8Encode(e);do{t=(a=e.charCodeAt(o++)<<16|e.charCodeAt(o++)<<8|e.charCodeAt(o++))>>18&63,n=a>>12&63,i=a>>6&63,r=63&a,l[u++]=s.charAt(t)+s.charAt(n)+s.charAt(i)+s.charAt(r)}while(o<e.length);switch(c=l.join(""),e.length%3){case 1:c=c.slice(0,-2)+"==";break;case 2:c=c.slice(0,-1)+"="}return c},each:function(e,t){if(this.isObject(e)&&void 0===e.length)for(var n in e)V.call(e,n)&&t(n,e[n],e);else{var i,r=e.length;for(i=0;i<r&&"break"!==t(e[i],i);i++);}},eachMap:function(e,t){if(Object&&Object.keys)for(var n=Object.keys(e),i=n.length,r=0;r<i;r++){var a=n[r];t&&t(a,e[a])}else for(var s in e)t&&t(s,e[s])},isObject:function(e){if("object"!==U(e)||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t},isEmptyObject:function(e){try{if(!e)return!0;if("function"==typeof Object.keys&&0===Object.keys(e).length)return!0;for(var t in e)if(V.call(e,t))return!1;return!0}catch(e){return!1}},assign:function(e,t){return"function"!=typeof Object.assign?function(e){for(var t=Object(e),n=1;n<arguments.length;n++){var i=arguments[n];if(null!==i)for(var r in i)V.call(i,r)&&(t[r]=i[r])}return t}(e,t):Object.assign({},e,t)},find:function(e,t){try{return e.find(t)}catch(i){for(var n=0;n<e.length;n++)if(t(e[n]))return e[n]}},checkDomain:function(e){var t=new RegExp(/^((http|https|''):\/\/)?([a-zA-Z0-9][-a-zA-Z0-9]{0,62}(\.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+(:[0-9]{1,5})*)$/),n=((e||"").match(t)||[])[0];return!(!e||!n)||(Q().tip_w(Q().repeat("!")),Q().tip_w("trackDomain error, please check trackDomain setting, current value is: "+e||0),Q().tip_w("we accept these three patterns:"),Q().tip_w("eg1: https://test-qtracking-xxx.com:port, port is optional"),Q().tip_w("eg2: http://test-qtracking-xxx.com:port, port is optional"),Q().tip_w("eg3: test-qtracking-xxx.com:port, port is optional"),Q().tip_w(Q().repeat("!")),!1)},checkEvent:function(e,t){if(!e||"string"!=typeof e)return Q().w("eventcode is invalid, id =",e||"'' event properties = ",JSON.stringfy(t)),!1;var n=["id","du"],i={};if(n.forEach((function(e){i[e]=1})),i[e])return Q().e("eventcode has conflict with reservewords: "+n.join(",")),!1;if(e.length>b)return Q().e("The maximum length of eventcode shall not exceed "+b),!1;if(t&&("object"!==U(t)||this.isArray(t))&&"string"!=typeof t)return Q().e("please check trackEvent properties. properties should be string or object(not include Array)"),!1;if(this.isArray(t)){var r=0;for(var a in t)if({}.hasOwnProperty.call(t,a)){if(a.length>k)return Q().e("The maximum length of property key shall not exceed "+k),!1;if(r>=I)return Q().e("The maximum count of properties shall not exceed "+I),!1;if(i[a])return Q().e("property key has conflict with reserveWords: "+n.join(",")),!1;r+=1}}return!0},fixDomain:function(e){return-1!==e.indexOf("https://")||-1!==e.indexOf("http://")?e:(e=(/^\/\//.test(e)?"":"//")+e,/(\d+\.){3,}\d+/.test(e)?"http:"+e:"https:"+e)},checkAppKey:function(e){if(e&&this.isString(e))return e;Q().tip_w(Q().repeat("!")),Q().tip_w("appKey error, please check appKey setting!"),Q().tip_w(Q().repeat("!"))},getRandomStr:function(e){for(var t="",n=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],i=0;i<Number(e);i++)t+=n[Math.round(Math.random()*(n.length-1))];return t},mangle:function(e){return{h:(t=e.header,n=K,i=H(t,n),t&&t.id_tracking&&(i[n.id_tracking||"id_tracking"]=H(t.id_tracking,R)),i),a:function(e,t){var n={};if(e)for(var i in e)e[i]&&(n[t[i]]=e[i]);return n}(e.analytics,F)};var t,n,i},hasOwnProperty:V,hash:function(e,t){var n,i=t||1315423911;for(n=e.length-1;n>=0;n--)i^=(i<<5)+e.charCodeAt(n)+(i>>2);return(2147483647&i).toString(16)},clone:function(e){var t,n=Array.isArray(e)?[]:{};if("object"===U(e)){if(JSON&&JSON.parse)t=JSON.stringify(e),n=JSON.parse(t);else for(var i in e)n[i]="object"===U(e[i])?this.clone(e[i]):e[i];return n}}},B=Z;function W(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function X(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Y,ee,te=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),X(this,"_globalProperty",{}),X(this,"_appKey",""),X(this,"_puid",""),X(this,"_config",{}),X(this,"_pageConfig",{}),X(this,"_debugId",void 0)}var t,n,i;return t=e,i=[{key:"getInstance",value:function(){return this.instance||(this.instance=new e),this.instance}}],(n=[{key:"puid",get:function(){return this._puid},set:function(e){this._puid=e}},{key:"appKey",get:function(){return this._appKey},set:function(e){this._appKey=e}},{key:"globalproperty",get:function(){return this._globalProperty||{}},set:function(e){this._globalProperty=e}},{key:"debugId",get:function(){return this._debugId},set:function(e){this._debugId=e}},{key:"setItem",value:function(e,t){this._config[e]=t}},{key:"getItem",value:function(e){return this._config[e]}}])&&W(t.prototype,n),i&&W(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}().getInstance(),ne=(Y={default:()=>e.default},ee={},s.d(ee,Y),ee),ie=(e=>{var t={};return s.d(t,e),t})({default:()=>t.default});function re(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ae(e,t,n){return t&&re(e.prototype,t),n&&re(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var se=ae((function e(t,n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=t,this.ts=Date.now(),this.cusp=Object.create(null),B.isObject(n))for(var i in n)B.hasOwnProperty.call(n,i)&&("ts"===i?this[i]=n[i]:this.cusp[i]=n[i]);var r=ne.default.getInfo();r&&r.source&&r.source.extra&&r.source.extra.scene&&(this.scene=r.source.extra.scene);var a=ie.default.getState();this.url=B.isObject(a)?a.path:"",this.page_name=n[v]||this.url,this.page_title=n[p]||(B.isObject(a)?a.name:""),this.gp=te.globalproperty,this.track_type="0",Q().i("before send eventcode =",this.id),B.isEmptyObject(this.cusp)||Q().i("event properties = ",this.cusp)}));function oe(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ue(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ce=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ue(this,"_maxCount",0),ue(this,"_items",[]),this._maxCount=t||0}var t,n;return t=e,(n=[{key:"enqueue",value:function(e){"number"==typeof this._maxCount&&this.size()>=this._maxCount&&this.dequeue(),this._items.push(e)}},{key:"dequeue",value:function(){return this._items.shift()}},{key:"front",value:function(){return this._items[0]}},{key:"isEmpty",value:function(){return 0===this._items.length}},{key:"clear",value:function(){this._items.length=0}},{key:"size",value:function(){return this._items.length}},{key:"items",value:function(){return this._items}},{key:"print",value:function(){Q().i(this._items.toString())}}])&&oe(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function le(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var fe=function(){function e(){var t,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n={},(t="config")in this?Object.defineProperty(this,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):this[t]=n}var t,n,i;return t=e,i=[{key:"getInstance",value:function(){return this._instance||(this._instance=new e),this._instance}}],(n=[{key:"setItem",value:function(e,t){this.config[e]=t}},{key:"getItem",value:function(e){return this.config[e]}},{key:"getALL",value:function(){return this.config}},{key:"updateRemoteConfig",value:function(e){var t,n;e&&(B.hasOwnProperty.call(e,"currentDeviceEnable")&&this.setItem(T,e.currentDeviceEnable),B.hasOwnProperty.call(e,"eventSamplingRate")&&B.isArray(e.eventSamplingRate)&&e.eventSamplingRate.length>0&&this.setItem(A,(t=e.eventSamplingRate,n=[],B.each(t,(function(e){e.eventIds&&e.eventIds.length>0&&B.each(e.eventIds,(function(t){n.push({eventId:t,samplingRate:e.samplingRate})}))})),n)))}}])&&le(t.prototype,n),i&&le(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}().getInstance(),de=(e=>{var t={};return s.d(t,e),t})({default:()=>n.default});function he(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function pe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ve=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),pe(this,"_name",""),pe(this,"_data",null),pe(this,"_loaded",!1)}var t,n,i;return t=e,i=[{key:"getInstance",value:function(){return this.instance||(this.instance=new e),this.instance}}],(n=[{key:"load",value:function(e){if(this._data)e&&e();else{var t=this;this.getStorage({key:j,success:function(n){if(n){var i=JSON.parse(n);fe.updateRemoteConfig(i)}t._loaded=!0,t._data={},B.isFunction(e)&&e(t._loaded)},fail:function(n){Q().w("cache loaded failed, errmsg = ",n),B.isFunction(e)&&e(t._loaded)}})}}},{key:"set",value:function(e){var t=e.key,n=e.value;this._data&&(this._data[t]=n)}},{key:"get",value:function(e){return(this._data||{})[e]}},{key:"isLoaded",value:function(){return this._loaded}},{key:"remove",value:function(e){this._data&&this._data[e]&&delete this._data[e]}},{key:"getAll",value:function(){return this._data}},{key:"clear",value:function(){this._data=null}},{key:"has",value:function(e){return!!this.get(e)}},{key:"getStorage",value:function(e){var t=e.key,n=e.success,i=e.fail;de.default.get({key:t,success:function(e){B.isFunction(n)&&n(e)},fail:function(e,t){Q().w("get storage failed, errcode = ",t),B.isFunction(i)&&i(e)}})}},{key:"setStorage",value:function(e){var t=e.key,n=e.value,i=e.success,r=e.fail;de.default.set({key:t,value:B.isString(n)?n:JSON.stringify(n),success:function(e){B.isFunction(i)&&i(e)},fail:function(e,t){Q().w("set storage failed, errcode = ".concat(t)),B.isFunction(r)&&r(e)}})}},{key:"deleteStorage",value:function(e){var t=e.key,n=e.success;de.default.delete({key:t,success:n})}}])&&he(t.prototype,n),i&&he(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}().getInstance();function ye(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ge(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var _e=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ge(this,"_memoryEvents",[]),ge(this,"_noSessionEvents",[]),ge(this,"_sessionId","sessionid")}var t,n,i;return t=e,i=[{key:"getInstance",value:function(){return this.instance||(this.instance=new e),this.instance}}],(n=[{key:"_getCacheEventsLength",value:function(e){var t=0;for(var n in e)B.isArray(e[n])&&(t+=e[n].length);return t}},{key:"_buildEkvs",value:function(e,t){var n=(e=e||{})[this._sessionId];return B.isArray(n)&&n.length?e[this._sessionId]=n.concat(t):e[this._sessionId]=[].concat(t),e}},{key:"_cacheEvents",value:function(){if(this._memoryEvents.length){var e=ve.get(y);this._getCacheEventsLength(e)+this._memoryEvents.length<=g&&(e=this._buildEkvs(e,this._memoryEvents),ve.set(y,e))}}},{key:"addEvent",value:function(e){this._sessionId?(this._memoryEvents.unshift(e),this._memoryEvents.length>_&&(this._cacheEvents(this._sessionId),this._memoryEvents.length=0)):(Q().w("session id is null: ",this._sessionId),this._noSessionEvents.unshift(e))}},{key:"setSessionId",value:function(e){if(this._sessionId=e||"sessionid",B.isArray(this._noSessionEvents)&&this._noSessionEvents.length){for(var t=0;t<this._noSessionEvents.length;t++)this.addEvent(this._noSessionEvents[t]);this._noSessionEvents.length=0}}},{key:"getEkvs",value:function(){var e=ve.get(y);return this._memoryEvents&&this._memoryEvents.length&&(e=this._buildEkvs(e,this._memoryEvents)),e}},{key:"clear",value:function(){ve.remove(y),this._memoryEvents=[],this._noSessionEvents=[]}},{key:"getEkvsLen",value:function(){var e=(ve.get(y)||{})[this._sessionId]||[],t=this._memoryEvents?this._memoryEvents.length:0;return e.length+t}}])&&ye(t.prototype,n),i&&ye(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}().getInstance(),me=function(e){var t=null;return e===C.EKV&&(t=function(){var e=null,t=_e.getEkvs();return t&&(e={analytics:{ekvs:B.clone(t)}},_e.clear()),e}()),t},be=(e=>{var t={};return s.d(t,e),t})({default:()=>i.default}),ke=(e=>{var t={};return s.d(t,e),t})({default:()=>r.default});function Ie(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function we(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Oe(e,t){be.default.getInfo({success:function(n){var i=Number(n.windowWidth),r=Number(n.windowHeight),a=n.brand,s=n.model;e.device_type=n.deviceType,e.os=n.osType,e.os_version=n.osVersionName,e.pixel_ratio=n.screenDensity,e.resolution=i>r?i+"*"+r:r+"*"+i,e.language=n.language,e.platform_version=n.platformVersionName,e.platform_sdk_version=n.platformVersionCode,e.device_model=s,e.device_brand=a,e.device_name=s,e.device_manufacturer=n.manufacturer,e.product=n.product,t&&B.isFunction(t)&&t(e)},fail:function(n){Q().i("quickapp get deviceInfo failed, errmsg=",n),t&&B.isFunction(t)&&t(e)}})}var Ee=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),we(this,"_header",{}),we(this,"_loaded",!1),we(this,"baseHeader",{sdk_version:"1.0.0",sdk_name:"qt_quickapp_sdk",platform:"quickapp",sdk_type:"quickappmp"})}var t,n,i;return t=e,i=[{key:"getInstance",value:function(){return this._instance||(this._instance=new e),this._instance}}],(n=[{key:"init",value:function(e){var t,n,i=this;t=this.baseHeader,n=function(t){i._header=t,i._loaded=!0,i._header.appKey=te.appKey,B.isFunction(e)&&e()},t.device_type="Phone",function(e,t){ke.default.getType({success:function(t){e.access=t.type},fail:function(e){Q().i("quickapp get network info failed. errmsg=",e)},complete:function(){Oe&&Oe(e,t)}})}(t,n)}},{key:"isLoaded",value:function(){return this._loaded}},{key:"get",value:function(){return this._header}},{key:"setItem",value:function(t,n){e.getInstance()._header[t]=n}},{key:"getItem",value:function(t){return e.getInstance()._header[t]}},{key:"setIdTracking",value:function(e){this.setItem(w,e)}},{key:"setIdType",value:function(e){this.setItem(O,e)}}])&&Ie(t.prototype,n),i&&Ie(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}().getInstance(),Se=(e=>{var t={};return s.d(t,e),t})({default:()=>a.default});function je(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Pe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Te(){return B.getRandomStr(10)+Date.now()+B.getRandomStr(7)+q}var Ae=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Pe(this,"_idType",N.uuid),Pe(this,"_uuid",""),Pe(this,"_userId",""),Pe(this,"_openId",""),Pe(this,"_unionId",""),Pe(this,"_advertisingId",""),Pe(this,"_phoneNumber",""),Pe(this,"_androidId",""),Pe(this,"_deviceId",""),Pe(this,"_mac",""),Pe(this,"_serial",""),Pe(this,"_oaid","")}var t,n,i;return t=e,i=[{key:"getInstance",value:function(){return this._instance||(this._instance=new e),this._instance}}],(n=[{key:"init",value:function(){this.initUUID(),this.initUserId()}},{key:"initUUID",value:function(){var e=this;ve.getStorage({key:N.uuid,success:function(t){t?e._uuid=t:(e._uuid=Te(),ve.setStorage({key:N.uuid,value:e._uuid}))},fail:function(){e._uuid=Te(),ve.setStorage({key:N.uuid,value:e._uuid})}})}},{key:"initUserId",value:function(){var e=this;ve.getStorage({key:N.userid,success:function(t){e._userId=t}})}},{key:"setUserId",value:function(t){e.getInstance()._userId=t,ve.set({key:N.userid,value:t}),ve.setStorage({key:N.userid,value:t,success:function(e){Q().i("login success, puid = ",e)},fail:function(e){Q().w("login failed, err = ",e)}})}},{key:"setOpenId",value:function(e){this._openId=e}},{key:"setUnionId",value:function(e){this._unionId=e}},{key:"setAdvertisingId",value:function(e){this._advertisingId=e}},{key:"setPhonenum",value:function(e){this._phoneNumber=e}},{key:"setAndroidId",value:function(e){this._androidId=e}},{key:"setDeviceId",value:function(e){this._deviceId=e}},{key:"setMac",value:function(e){this._mac=e}},{key:"setSerial",value:function(e){this._serial=e}},{key:"setOaid",value:function(e){this._oaid=e}},{key:"removeUserId",value:function(e){this._userId="",ve.deleteStorage({key:N.userid,success:function(){e&&Q().i(e)}})}},{key:"setIDType",value:function(e){this._idType=e}},{key:"getIDType",value:function(){return this._idType}},{key:"getIDTracking",value:function(){var t={};return this._uuid&&(t.uuid=this._uuid),e.getInstance()._userId&&(t.userid=e.getInstance()._userid),e.getInstance()._advertisingId&&(t.advertisingid=e.getInstance()._advertisingId),e.getInstance()._openId&&(t.openId=e.getInstance()._openId),e.getInstance()._unionId&&(t.unionId=e.getInstance()._unionId),e.getInstance()._phoneNumber&&(t.phoneNumber=e.getInstance()._phoneNumber),e.getInstance()._androidId&&(t.androidid=e.getInstance()._phoneNumber),e.getInstance()._deviceId&&(t.deviceId=e.getInstance()._deviceId),e.getInstance()._mac&&(t.mac=e.getInstance()._mac),e.getInstance()._serial&&(t.serial=e.getInstance()._serial),e.getInstance()._oaid&&(t.oaid=e.getInstance()._oaid),t}}])&&je(t.prototype,n),i&&je(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}().getInstance();function De(e){var t,n,i=(t=e,n=te.getItem(u),B.fixDomain(n)+t);Se.default.fetch({url:i,method:"GET",responseType:"json",success:function(e){e.data&&e.data.data&&(fe.updateRemoteConfig(e.data.data),ve.setStorage({key:j,value:e.data.data}))},fail:function(e){Q().w("remote configuration request failed, errmsg:",e)}})}function qe(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function xe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ce=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),xe(this,"_instance",null),xe(this,"_running",!1),xe(this,"_currentType",""),xe(this,"_failRequests",[]),xe(this,"_failQueue",new ce(m)),xe(this,"_queue",new ce(m)),this._currentType=t}var t,n,i;return t=e,i=[{key:"getInstance",value:function(t){return this._instance||(this._instance=new e(t)),this._instance}}],(n=[{key:"_enqueueRequest",value:function(e,t,n){var i=this;if(Ee.isLoaded()){t=t||{};var r=me(e);r&&(r.header=Ee,r.noCache=t.noCache,this._queue.enqueue(r)),B.isFunction(n)&&n()}else setTimeout((function(){i._enqueueRequest(e)}),100)}},{key:"_sendQueue",value:function(e,t){var n=(e===E?this._queue:this._failQueue).dequeue(),i=this;n?function(e,t,n,i){Ee.setIdType(Ae.getIDType()),Ee.setIdTracking(Ae.getIDTracking()),e.analytics&&(e.analytics.active_user={puid:te.puid||""}),e.header=B.assign(Ee.get(),{miniappDebugId:te.debugId,traceId:B.getRandomStr(10)+Date.now()+B.getRandomStr(9),app_version:ne.default.getInfo().versionName,appid:ne.default.getInfo().packageName,app_source_type:ne.default.getInfo().source.type});var r=B.mangle(e),a=B.base64Encode(JSON.stringify(r)),s=function(){var e=te.getItem(u);if(B.checkDomain(e))return B.fixDomain(e)+"/wxm_logs"}();Se.default.fetch({url:s,header:{"Content-Type":"qappmp/json","Msg-Type":"qappmp/json"},data:a,method:"POST",responseType:"json",success:function(i){200===i.code?(Q().i("data send success:",JSON.stringify(e)),function(e){try{var t=e.imprintVersion;ve.getStorage({key:P,success:function(e){e&&B.isString(e)?t&&t!==e?(De(t),ve.setStorage({key:P,value:t})):ve.getStorage({key:j,success:function(e){if(e){var t=JSON.parse(e);fe.updateRemoteConfig(t)}}}):(t&&De(t),t&&ve.setStorage({key:P,value:t}))},fail:function(e){Q().w("save imprint failed!, errmsg = ",e)}})}catch(e){Q().w("save imprint failed, errmsg = ",e)}}(i.data||{}),B.isFunction(t)&&t(i)):(Q().w("data send failed:",a),B.isFunction(n)&&n())},fail:function(e){Q().w("timeout: ",a),B.isFunction(n)&&n()},complete:function(){B.isFunction(i)&&i()}})}(n,(function(){i._sendQueue(e,t)}),(function(){n&&!n.noCache&&i._failRequests.push(n),i._sendQueue(e,t)})):(i._processFailRequests(),t&&t())}},{key:"_processFailRequests",value:function(){var e=this;this._failRequests.forEach((function(t){e._queue.enqueue(t)})),this._failRequests.length=0}},{key:"_startSend",value:function(e,t){this._sendQueue(e,(function(){B.isFunction(t)&&t()}))}},{key:"send",value:function(e,t,n){var i=this;e?this.add(e,t,(function(){i._startSend(i._currentType,n)})):i._startSend(i._currentType,n)}},{key:"add",value:function(e,t,n){this._enqueueRequest(e,t,n)}},{key:"load",value:function(){var e=this._currentType===E?this._queue:this._failedQueue,t=ve.get(E);t&&t.length&&t.forEach((function(t){e.enqueue(t)})),ve.remove(E)}},{key:"save",value:function(){var e=(ve.get(S)||[]).concat(this._failedQueue.items());e&&e.length&&ve.set(S,e),this._failedQueue.clear()}}])&&qe(t.prototype,n),i&&qe(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}().getInstance(E);function Ne(){}Ne.prototype={on:function(e,t,n){var i=this.e||(this.e={});return(i[e]||(i[e]=[])).push({fn:t,ctx:n}),this},once:function(e,t,n){var i=this;function r(){i.off(e,r),t.apply(n,arguments)}return r._=t,this.on(e,r,n)},emit:function(e){for(var t=[].slice.call(arguments,1),n=((this.e||(this.e={}))[e]||[]).slice(),i=0,r=n.length;i<r;i++)n[i].fn.apply(n[i].ctx,t);return this},off:function(e,t){var n=this.e||(this.e={}),i=n[e],r=[];if(i&&t)for(var a=0,s=i.length;a<s;a++)i[a].fn!==t&&i[a].fn._!==t&&r.push(i[a]);return r.length?n[e]=r:delete n[e],this}};var Re=new Ne;Re.messageType={PARAMS_LOADED:0,SDK_INITED:1};var Ke=Re;function Fe(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Qe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ue=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Qe(this,"_inited",!1),Qe(this,"_appStartTime",0)}var t,n;return t=e,(n=[{key:"ready",get:function(){return this._inited}},{key:"init",value:function(){var e=this;Ae.init(),Ee.init((function(){ve.load((function(t){e._inited=t,Ke.emit(Ke.messageType.SDK_INITED)}))}))}},{key:"sendEvent",value:function(e,t){if(this._inited&&(fe.getItem(T)||/^(\$\$_app_start|\$\$_app_end)$/.test(e))&&B.checkEvent(e,t)&&function(e){var t=fe.getItem(A);if(t&&t.length>0){var n=B.find(t,(function(t){return t.eventId===e}));return!n||Math.ceil(1e3*Math.random())<1e3*n.samplingRate}return!0}(e)){var n=new se(e,t);_e.addEvent(n),Ce.send(C.EKV,{noCache:!0},(function(){}))}}},{key:"appLaunch",value:function(){var e=this;this._appStartTime=Date.now(),Ke.on(Ke.messageType.SDK_INITED,(function(){e.sendEvent(l,{ts:e._appStartTime})}))}},{key:"appHide",value:function(){var e=Date.now(),t=e-this._appStartTime;this.sendEvent(f,{ts:e,duration:t})}},{key:"sendPageStart",value:function(e){this.sendEvent(d,B.assign(e,{ts:Date.now()}))}},{key:"sendUserProfile",value:function(e){this.sendEvent(h,e)}},{key:"getGlobalProperty",value:function(){return te.globalproperty||{}}},{key:"setGlobalProperty",value:function(e){if(B.isArray(e)||B.isObject(e)){var t=!1;B.eachMap(e,(function(n,i){if(B.isArray(i)||B.isObject(i))return t=!0,Q().w("globalproperty k/v pair should not contain nested json format. current value=\n"),void Q().w(JSON.stringify(e))})),t||(te.globalproperty=B.clone(e))}else Q().w("setGlobalProperty can only be assigned as Object/Array format value.")}},{key:"appendGlobalProperty",value:function(e){B.isArray(e)||B.isObject(e)?te.globalProperty=B.clone(B.assign(te.globalProperty,e)):Q().w("appendGlobalProperty can only be assigned as Object/Array format value.")}},{key:"login",value:function(e){e&&Ae.setUserId(e)}},{key:"logoff",value:function(){Ae.removeUserId("logoff success!")}},{key:"setIdTracking",value:function(e){for(var t in e)switch(t){case N.openid:Ae.setOpenId(e[t]);break;case N.unionid:Ae.setUnionId(e[t]);break;case N.adroidid:Ae.setAndroidId(e[t]);break;case N.advertisingid:Ae.setAdvertisingId(e[t]);break;case N.phonenumber:Ae.setPhonenum(e[t]);break;case N.deviceId:Ae.setDeviceId(e[t]);break;case N.mac:Ae.setMac(e[t]);break;case N.serial:Ae.setSerial(e[t]);break;case N.oaid:Ae.setOaid(e[t]);break;default:Q().w("invalid id key = ",t)}}}])&&Fe(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Le(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Ge(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Je=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Ge(this,"_params",{name:"qt"}),Ge(this,"_core",null),this._core=new Ue}var t,n,i;return t=e,i=[{key:"getInstance",value:function(){return this._instance||(this._instance=new e),this._instance}}],(n=[{key:"init",value:function(t){try{var n=t||function(){try{return s.g.__proto__||s.g||window}catch(e){Q().w("get context failed",e)}}();n&&(n[this._params.name]=e.getInstance(),n.$app&&(n.$app[this._params.name]=e.getInstance())),this._core.init();var i=this;Ke.on(Ke.messageType.SDK_INITED,(function(){i._core.ready?Q().v("QT SDK init success!!!"):(Q().v("QT SDK init failed, current setting is: \n"),Q().v(JSON.stringify(e.getInstance()._params)))}))}catch(e){Q().w("qt quickapp init failed!")}}},{key:"setParams",value:function(t){var n=this;t&&B.isObject(t)&&(Q().setDebug(!!t.showLog),B.eachMap(t,(function(t,i){switch(t){case u:B.checkDomain(i)&&(e.getInstance()._params[t]=i,te.setItem(u,i));break;case c:B.checkAppKey(i)&&(e.getInstance()._params[t]=i,te.appKey=i);break;case N.userid:te.puid=i;break;case D:n.setGlobalProperty(i);break;case x:te.debugId=i;break;default:e.getInstance()._params[t]=i}})))}},{key:"setIds",value:function(e){this._core&&B.isObject(e)&&this._core.setIdTracking(e)}},{key:"appLaunch",value:function(e){this._core&&this._core.appLaunch(e)}},{key:"appHide",value:function(e){this._core&&this._core.appHide(e)}},{key:"sendPageStart",value:function(e){this._core&&this._core.sendPageStart(e)}},{key:"sendUserProfile",value:function(e){this._core&&this._core.sendUserProfile(e)}},{key:"sendEvent",value:function(e,t){this._core&&this._core.sendEvent(e,t)}},{key:"setGlobalProperty",value:function(e){this._core&&this._core.setGlobalProperty(e)}},{key:"appendGlobalProperty",value:function(e){this._core&&this._core.appendGlobalProperty(e)}},{key:"getGlobalProperty",value:function(){return this._core?this._core.getGlobalProperty():{}}},{key:"login",value:function(e){this._core.login(e)}},{key:"logoff",value:function(){this._core.logoff()}}])&&Le(t.prototype,n),i&&Le(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}().getInstance(),Me=o.Z;export{Me as default};